<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="addressbook.css">
</head>
<body class="addContact">
<form id="editform">
  <label>Name</label>
  <input class="addFormInput" type="text" value="" name="editcontactname" id="editcontactname" />
  <br>
  <label>Number</label>
  <input class="addFormInput" type="text" name="editcontactnumber" id="editcontactnumber" />
  <br>
  <label>Cellphone Number</label>
  <input class="addFormInput" type="tel" name="editcontactcellphone" id="editcontactcellphone" />
  <br>
  <label>Email</label>
  <input class="addFormInput" type="text" name="editcontactemail" id="editcontactemail" />
  <br>
  <label>Address</label>
  <input class="addFormInput" type="text" name="editcontactaddress" id="editcontactaddress" />
  <br>
  <label>Birth date</label>
  <input class="addFormInput" min="1900-01-01" max="2019-12-29" type="date" name="editcontactbirthdate" id="editcontactbirthdate" />
  <br>
  <label>Company</label>
  <input class="addFormInput" type="text" name="editcontactcompany" id="editcontactcompany" />
  <br>
  <label>URL</label>
  <input class="addFormInput" type="url" name="editcontacturl" id="editcontacturl" />
  <br>
  <label>Photo</label>
  <input class="addFormInput" type="file" name="editcontactphoto" id="editcontactphoto" accept="image/*" />
  <br>
  <button class="buttone" id="addsbtn" type="submit">Update</button>
  <button class="buttone" id="cancelbtn">Cancel</button>
</form>
<script src="./addressbook.js"></script>

<script>
  var editingIndex = 0;
  try {
    let $ = require('jquery')

    $(document).ready(function() { require('electron').ipcRenderer.send('pageDoneLoading') })
    
    require('electron').ipcRenderer.on('sendingContact', (event, contact, index) => {
        $('#editcontactname').val(contact.name) 
        $('#editcontactnumber').val(contact.number)    
        $('#editcontactcellphone').val(contact.cellphone)    
        $('#editcontactemail').val(contact.email)    
        $('#editcontactaddress').val(contact.address)    
        $('#editcontactbirthdate').val(contact.birthdate)    
        $('#editcontactcompany').val(contact.company)    
        $('#editcontacturl').val(contact.url)    
        $('#editcontactphoto').val(contact.photo)    

        editingIndex = index;
        
      })
  } catch (error) {
  }
    
  $(document).ready(function() {

$('#editform').validate({ // initialize the plugin
    rules: {
      editcontactname: {
            required: true
        },
        editcontactnumber: {
          phoneUS: true
        },
        editcontactcellphone: {
          phoneUS: true
        },
        editcontactemail: {
          email: true
        },
        editcontacturl: {
          url: true
        },
        editcontactphoto: {
         extension: "jpg|png|gif|jpeg|bmp"
        }
    },
    submitHandler: function(form) { // for demo
                
        let name = $('#editcontactname').val()
        let number = $('#editcontactnumber').val()
        let cellphone = $('#editcontactcellphone').val()
        let email = $('#editcontactemail').val()
        let address = $('#editcontactaddress').val()
        let birthdate = $('#editcontactbirthdate').val()
        let company = $('#editcontactcompany').val()
        let url = $('#editcontacturl').val()
        let photo = $('#editcontactphoto').val()

        if (number != "" && number.length == 10){
          number = '('+ number.slice(0, 3)+ ')' + " " + number.slice(3,6) + " - " + number.slice(6,10);
        }
        if (number != "" && number.length == 12){
          number = '('+ number.slice(0, 3)+ ')' + " " + number.slice(4,7) + " - " + number.slice(8,12);
        }

        if (cellphone != "" && cellphone.length == 10){
          cellphone = '('+ cellphone.slice(0, 3)+ ')' + " " + cellphone.slice(3,6) + " - " + cellphone.slice(6,10);
        }
        if (cellphone != "" && cellphone.length == 12){
          cellphone = '('+ cellphone.slice(0, 3)+ ')' + " " + cellphone.slice(4,7) + " - " + cellphone.slice(8,12);
        }

        fs.appendFileSync('contacts.txt', name+","+number+","+cellphone+","+email+","+address+","+birthdate+","+company+","+url+","+photo+'\n', (err) => {
          if (err) throw err;
          console.log("the data was appended!");
        });

        ipcRenderer.send('asynchronous-message', 'closeAndRefresh')

    }
});


});

</script>

</body>
</html>
